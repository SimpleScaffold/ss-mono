# Host 앱과 Remote 앱 기능 정의

Host 앱과 Remote 앱에 들어가야 하는 기능을 명확히 정의합니다.

## 📋 목차

- [Host 앱 기능 정의](#host-앱-기능-정의)
- [Remote 앱 기능 정의](#remote-앱-기능-정의)
- [기능 분리 원칙](#기능-분리-원칙)
- [기능 추가 가이드](#기능-추가-가이드)

## Host 앱 기능 정의

Host 앱(Shell 앱)은 전체 애플리케이션의 **기반 인프라**와 **공통 기능**을 담당합니다.

### 1. 모듈 페더레이션 관리

#### 1.1 Remote App 동적 로드

- **책임**: 런타임에 Remote App을 동적으로 로드하고 통합
- **구현**: `lazy()`와 `Suspense`를 사용한 동적 import
- **기능**:
    - Remote App 로딩 상태 관리
    - 로딩 실패 시 에러 핸들링
    - 로딩 중 UI 표시 (로딩 스피너, 스켈레톤 등)

#### 1.2 Remote App 라이프사이클 관리

- **책임**: Remote App의 마운트/언마운트 관리
- **기능**:
    - 조건부 로딩 (필요한 Remote App만 로드)
    - 메모리 관리 (사용하지 않는 Remote App 언마운트)
    - Remote App 간 전환 관리

#### 1.3 개발 환경 안정성

- **책임**: 개발 환경에서 Remote App과의 통합 안정성 보장
- **기능**:
    - Remote App 준비 대기 (`waitForRemote` 플러그인)
    - HMR 동기화 (`@antdevx/vite-plugin-hmr-sync`)
    - Manifest 방식 모듈 로딩

### 2. 공통 컴포넌트 및 리소스 공유

#### 2.1 공통 UI 컴포넌트 Expose

- **책임**: `@repo/fe-ui` 패키지의 컴포넌트를 런타임에 Remote App에 제공
- **현재 상태**: 빌드 타임 공유 (향후 런타임 Expose로 전환 예정)
- **기능**:
    - Button, Dialog, Card 등 공통 컴포넌트 제공
    - Single Source of Truth 유지
    - 디자인 시스템 일관성 보장

#### 2.2 공통 유틸리티 함수 공유

- **책임**: `@repo/fe-utils` 패키지의 유틸리티 함수 제공
- **기능**:
    - 날짜 포맷팅 (`formatDate`)
    - 데이터 변환 함수
    - 공통 헬퍼 함수

#### 2.3 테마 및 스타일 시스템

- **책임**: 전체 애플리케이션의 테마와 스타일 관리
- **기능**:
    - Theme Provider 제공
    - CSS 변수 관리
    - 다크 모드 지원 (향후)
    - 반응형 레이아웃 설정

### 3. Shell 레이아웃 및 네비게이션

#### 3.1 공통 레이아웃 구조

- **책임**: 전체 애플리케이션의 기본 레이아웃 제공
- **기능**:
    - 헤더/푸터 레이아웃
    - 사이드바 네비게이션
    - 컨텐츠 영역 관리
    - 반응형 레이아웃

#### 3.2 라우팅 관리

- **책임**: 전체 애플리케이션의 라우팅 관리
- **기능**:
    - 메인 라우터 설정
    - Remote App 간 라우팅 전환
    - 브레드크럼 네비게이션
    - URL 파라미터 관리

#### 3.3 네비게이션 메뉴

- **책임**: 사용자 네비게이션 인터페이스 제공
- **기능**:
    - 메인 메뉴 구성
    - Remote App 메뉴 항목 표시
    - 활성 메뉴 하이라이트
    - 모바일 메뉴 (햄버거 메뉴)

### 4. 공통 리소스 관리

#### 4.1 Cesium Viewer 관리 (향후)

- **책임**: Cesium 3D 지도 뷰어의 단일 인스턴스 관리
- **기능**:
    - Cesium Viewer 초기화 및 관리
    - 메모리 효율적인 단일 인스턴스 제공
    - Remote App에서 Cesium Viewer 접근 API 제공
    - 지도 상태 관리 (카메라 위치, 레이어 등)

#### 4.2 전역 상태 관리

- **책임**: 애플리케이션 전역 상태 관리
- **기능**:
    - 사용자 인증 상태
    - 전역 설정 (언어, 테마 등)
    - Remote App 간 공유 데이터
    - 상태 동기화 메커니즘

#### 4.3 API 클라이언트 관리

- **책임**: 공통 API 클라이언트 및 인터셉터 관리
- **기능**:
    - HTTP 클라이언트 설정
    - 인증 토큰 관리
    - API 에러 핸들링
    - 요청/응답 인터셉터

### 5. 사용자 인증 및 권한 관리

#### 5.1 인증 관리

- **책임**: 사용자 인증 상태 관리
- **기능**:
    - 로그인/로그아웃 처리
    - 인증 토큰 관리
    - 세션 관리
    - 인증 상태 전역 공유

#### 5.2 권한 관리

- **책임**: 사용자 권한 기반 접근 제어
- **기능**:
    - 권한 체크 유틸리티
    - 권한 기반 라우팅 가드
    - Remote App 접근 권한 제어
    - 권한 변경 시 UI 업데이트

### 6. 에러 처리 및 모니터링

#### 6.1 전역 에러 처리

- **책임**: 애플리케이션 전역 에러 처리
- **기능**:
    - 에러 바운더리 (Error Boundary)
    - Remote App 에러 캐치
    - 에러 로깅
    - 사용자 친화적 에러 메시지 표시

#### 6.2 모니터링 및 로깅

- **책임**: 애플리케이션 모니터링 및 로깅
- **기능**:
    - 성능 모니터링
    - 에러 추적
    - 사용자 행동 분석
    - Remote App 로딩 성능 추적

### 7. 개발자 도구 및 유틸리티

#### 7.1 개발 모드 기능

- **책임**: 개발 환경에서 유용한 도구 제공
- **기능**:
    - Remote App 로딩 상태 표시
    - 모듈 페더레이션 디버깅 도구
    - 성능 프로파일링 도구
    - 개발자 콘솔 유틸리티

### 8. Host 앱 전용 UI 컴포넌트

#### 8.1 Shell 전용 컴포넌트

- **책임**: Host 앱에서만 사용하는 UI 컴포넌트
- **예시**:
    - ProfileDialog: 사용자 프로필 편집 다이얼로그
    - ItemCard: 호스트 앱 전용 아이템 카드
    - Shell 전용 네비게이션 컴포넌트

**주의**: Remote App에서도 사용할 수 있는 공통 컴포넌트는 `@repo/fe-ui` 패키지에 있어야 합니다.

## Remote 앱 기능 정의

Remote 앱은 **특정 기능 영역**을 담당하는 독립적인 마이크로 프론트엔드 애플리케이션입니다.

### 1. 독립적 기능 개발

#### 1.1 도메인별 기능 구현

- **책임**: 특정 비즈니스 도메인 또는 기능 영역 구현
- **원칙**:
    - 각 Remote App은 하나의 명확한 도메인을 담당
    - 다른 Remote App의 기능과 격리
    - 독립적으로 개발, 테스트, 배포 가능

#### 1.2 자체 상태 관리

- **책임**: Remote App 내부 상태 관리
- **기능**:
    - 로컬 상태 관리 (useState, useReducer 등)
    - Remote App 전용 상태 관리 라이브러리 사용 가능
    - Host 앱과의 상태 동기화 (필요 시)

#### 1.3 독립적 라우팅

- **책임**: Remote App 내부 라우팅 관리
- **기능**:
    - Remote App 내부 페이지 라우팅
    - 쿼리 파라미터 관리
    - 브라우저 히스토리 관리

### 2. Host 앱 리소스 활용

#### 2.1 공통 컴포넌트 사용

- **책임**: Host 앱에서 제공하는 공통 컴포넌트 사용
- **현재**: 빌드 타임에 `@repo/fe-ui` 패키지 import
- **향후**: 런타임에 Host 앱에서 동적 import
- **기능**:
    - Button, Dialog, Card 등 공통 컴포넌트 사용
    - 일관된 디자인 시스템 준수
    - 테마 자동 적용

#### 2.2 공통 유틸리티 사용

- **책임**: Host 앱에서 제공하는 유틸리티 함수 사용
- **기능**:
    - 날짜 포맷팅 (`formatDate`)
    - 데이터 변환 함수
    - 공통 헬퍼 함수

#### 2.3 Host 앱 API 활용

- **책임**: Host 앱에서 제공하는 API 및 서비스 사용
- **기능**:
    - Cesium Viewer 접근 (향후)
    - 전역 상태 접근 (필요 시)
    - 인증 정보 접근
    - API 클라이언트 사용

### 3. Remote App별 특화 기능

#### 3.1 Remote App 1 (remoteapp1) - 아이템 관리

- **기능**:
    - 아이템 목록 표시
    - 아이템 상세 정보 표시
    - 아이템 상태 관리 (Active, Completed 등)
    - 날짜 정보 표시 및 포맷팅

#### 3.2 Remote App 2 (remoteapp2) - 사용자 프로필 관리

- **기능**:
    - 사용자 프로필 정보 표시
    - 프로필 편집 폼
    - 프로필 정보 저장
    - 프로필 이미지 관리 (향후)

#### 3.3 추가 Remote App 예시

- **Remote App 3**: 대시보드 및 통계
- **Remote App 4**: 설정 및 환경 구성
- **Remote App 5**: 알림 및 메시지 관리

### 4. 독립적 배포 및 버전 관리

#### 4.1 독립적 빌드

- **책임**: Remote App의 독립적 빌드
- **기능**:
    - 자체 빌드 프로세스
    - 빌드 최적화
    - 번들 크기 최적화
    - 소스맵 생성

#### 4.2 독립적 배포

- **책임**: Remote App의 독립적 배포
- **기능**:
    - 자체 CI/CD 파이프라인
    - 독립적인 배포 주기
    - 버전 태깅
    - 롤백 가능

#### 4.3 버전 관리

- **책임**: Remote App의 독립적 버전 관리
- **기능**:
    - Semantic Versioning
    - 변경 로그 관리
    - 호환성 관리

### 5. Remote App 간 통신 (필요 시)

#### 5.1 이벤트 기반 통신

- **책임**: Remote App 간 이벤트 통신
- **기능**:
    - CustomEvent 사용
    - 이벤트 버스 패턴
    - Pub/Sub 패턴

#### 5.2 상태 공유 (필요 시)

- **책임**: Remote App 간 상태 공유
- **기능**:
    - Host 앱을 통한 상태 공유
    - 전역 상태 관리 라이브러리 활용
    - URL 파라미터를 통한 상태 전달

**주의**: Remote App 간 직접적인 의존성은 피해야 합니다. 필요 시 Host 앱을 통한 간접 통신을 사용합니다.

### 6. 에러 처리 및 로깅

#### 6.1 로컬 에러 처리

- **책임**: Remote App 내부 에러 처리
- **기능**:
    - 컴포넌트 레벨 에러 바운더리
    - 사용자 친화적 에러 메시지
    - 에러 복구 메커니즘

#### 6.2 로깅

- **책임**: Remote App 내부 로깅
- **기능**:
    - 구조화된 로깅
    - 에러 로깅
    - 성능 로깅
    - Host 앱 로깅 시스템과 통합 (선택적)

## 기능 분리 원칙

### Host 앱에 포함해야 하는 기능

✅ **포함해야 할 기능:**

- 전체 애플리케이션에 공통으로 필요한 기능
- 여러 Remote App에서 공유해야 하는 리소스
- Shell 레이아웃 및 네비게이션
- 전역 상태 관리
- 공통 컴포넌트 및 유틸리티
- 인증 및 권한 관리
- 에러 처리 및 모니터링

### Remote 앱에 포함해야 하는 기능

✅ **포함해야 할 기능:**

- 특정 도메인에 특화된 기능
- 독립적으로 개발 및 배포 가능한 기능
- Remote App 내부에서만 사용하는 상태 및 로직
- Remote App 전용 UI 컴포넌트

### 기능 분리 체크리스트

새로운 기능을 추가할 때 다음 질문을 확인하세요:

#### Host 앱에 추가할지 확인:

- [ ] 이 기능이 여러 Remote App에서 공유되나요?
- [ ] 이 기능이 Shell 레이아웃/네비게이션과 관련이 있나요?
- [ ] 이 기능이 전역 상태나 인증과 관련이 있나요?
- [ ] 이 기능이 공통 컴포넌트나 유틸리티인가요?

#### Remote 앱에 추가할지 확인:

- [ ] 이 기능이 특정 도메인에만 특화되어 있나요?
- [ ] 이 기능이 독립적으로 개발 및 배포 가능한가요?
- [ ] 이 기능이 다른 Remote App과 격리되어 있나요?
- [ ] 이 기능이 Host 앱의 핵심 코드를 수정하지 않고 구현 가능한가요?

## 기능 추가 가이드

### Host 앱에 기능 추가하기

1. **공통 컴포넌트 추가**

    ```bash
    # @repo/fe-ui 패키지에 컴포넌트 추가
    cd packages/fe/ui
    # shadcn CLI로 컴포넌트 추가
    ```

2. **Shell 레이아웃 수정**

    ```bash
    # Host 앱 레이아웃 수정
    cd apps/fe/host/hostapp1/src
    # 레이아웃 컴포넌트 수정
    ```

3. **전역 상태 추가**
    ```bash
    # Host 앱에 전역 상태 관리 추가
    # Context API 또는 상태 관리 라이브러리 사용
    ```

### Remote 앱에 기능 추가하기

1. **새 Remote App 생성**

    ```bash
    # Remote App 템플릿 복사
    cp -r apps/fe/remote/remoteapp1 apps/fe/remote/remoteapp3
    # 설정 파일 수정 (포트, 이름 등)
    ```

2. **기능 구현**

    ```bash
    # Remote App 내부에서 기능 구현
    cd apps/fe/remote/remoteapp3/src
    # 컴포넌트 및 로직 구현
    ```

3. **Host 앱에 통합**
    ```bash
    # Host 앱의 vite.config.ts에 Remote 추가
    # Host 앱의 컴포넌트에서 Remote App 로드
    ```

### 기능 이동 가이드

기능을 Host 앱과 Remote 앱 간에 이동할 때:

1. **Host → Remote 이동**
    - 기능이 특정 도메인에만 특화된 경우
    - 독립적으로 배포 가능한 경우
    - 다른 Remote App과 격리되어야 하는 경우

2. **Remote → Host 이동**
    - 여러 Remote App에서 공유해야 하는 경우
    - Shell 레이아웃/네비게이션과 관련된 경우
    - 전역 상태나 인증과 관련된 경우

## 예시 시나리오

### 시나리오 1: 사용자 인증 기능

**Host 앱에 포함:**

- 로그인/로그아웃 처리
- 인증 토큰 관리
- 인증 상태 전역 공유
- 인증 관련 API 클라이언트 설정

**Remote 앱에서 사용:**

- Host 앱의 인증 상태를 읽기만 함
- 인증이 필요한 기능에 접근 제어
- 인증 정보를 표시 (사용자 이름 등)

### 시나리오 2: 아이템 관리 기능

**Remote App 1에 포함:**

- 아이템 목록 표시
- 아이템 CRUD 작업
- 아이템 상태 관리
- 아이템 관련 API 호출

**Host 앱에서 제공:**

- 공통 UI 컴포넌트 (Button, Card 등)
- 공통 유틸리티 (날짜 포맷팅 등)
- 레이아웃 및 네비게이션

### 시나리오 3: Cesium Viewer 통합

**Host 앱에 포함:**

- Cesium Viewer 초기화 및 관리
- 단일 인스턴스 제공
- 지도 상태 관리 API

**Remote 앱에서 사용:**

- Host 앱의 Cesium Viewer 인스턴스 접근
- 지도에 레이어 추가/제거
- 카메라 위치 변경 요청

## 참고 자료

- [Shell + Micro Apps 아키텍처](./index.md) - 전체 아키텍처 설명
- [@repo/fe-ui 가이드](../04-packages/fe-ui.md) - 공통 UI 컴포넌트 패키지
- [@repo/fe-utils 가이드](../04-packages/fe-utils.md) - 공통 유틸리티 패키지
